---
// src/components/DisclaimerBanner.astro
// Dismissable disclaimer banner for regulatory compliance
---

<div
  id="disclaimer-banner"
  class="disclaimer-banner hidden"
  role="alert"
  aria-label="Risk Disclaimer"
>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between gap-4 py-2 text-sm">
      <p class="text-center flex-1">
        <strong>Not Financial Advice.</strong> Signals are for informational purposes only.
        Past performance does not guarantee future results.
        <a href="/terms" class="underline hover:text-white">Read full disclaimer â†’</a>
      </p>
      <button
        id="dismiss-disclaimer"
        type="button"
        class="shrink-0 p-1 hover:opacity-80 transition-opacity"
        aria-label="Dismiss disclaimer"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
  </div>
</div>

<style>
  .disclaimer-banner {
    background: linear-gradient(90deg, var(--accent) 0%, #f59e0b 100%);
    color: var(--bg);
    position: relative;
    z-index: 100;
  }

  .disclaimer-banner a {
    color: var(--bg);
    font-weight: 500;
  }

  .disclaimer-banner.hidden {
    display: none;
  }

  .disclaimer-banner.visible {
    display: block;
  }
</style>

<script>
  const STORAGE_KEY = 'disclaimerDismissed';
  const DISMISS_DURATION_DAYS = 7; // Show again after 7 days

  function initDisclaimerBanner() {
    const banner = document.getElementById('disclaimer-banner');
    const dismissBtn = document.getElementById('dismiss-disclaimer');

    if (!banner || !dismissBtn) return;

    // Check if dismissed within the last 7 days
    const dismissedAt = localStorage.getItem(STORAGE_KEY);
    if (dismissedAt) {
      const dismissedDate = new Date(parseInt(dismissedAt));
      const daysSinceDismiss = (Date.now() - dismissedDate.getTime()) / (1000 * 60 * 60 * 24);

      if (daysSinceDismiss < DISMISS_DURATION_DAYS) {
        return; // Keep hidden
      }
    }

    // Show banner
    banner.classList.remove('hidden');
    banner.classList.add('visible');

    // Handle dismiss
    dismissBtn.addEventListener('click', () => {
      localStorage.setItem(STORAGE_KEY, Date.now().toString());
      banner.classList.add('hidden');
      banner.classList.remove('visible');
    });
  }

  // Run on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDisclaimerBanner);
  } else {
    initDisclaimerBanner();
  }
</script>
