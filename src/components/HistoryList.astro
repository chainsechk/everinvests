---
// src/components/HistoryList.astro
import BiasIndicator from "./BiasIndicator.astro";

interface Signal {
  id: number;
  date: string;
  time_slot: string;
  bias: string;
  macro_overall: string | null;
  output_json: string | null;
}

interface Props {
  signals: Signal[];
  category: "crypto" | "forex" | "stocks";
}

const { signals, category } = Astro.props;

function formatDate(dateStr: string): string {
  try {
    const date = new Date(dateStr);
    return date.toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" });
  } catch {
    return dateStr;
  }
}

function extractSummary(outputJson: string | null): string | null {
  if (!outputJson) return null;
  try {
    const output = JSON.parse(outputJson);
    return output.summary || null;
  } catch {
    return null;
  }
}
---

<div class="space-y-4">
  {signals.map((signal) => (
    <div class="card hover:border-gray-600 transition-colors">
      <div class="flex flex-wrap items-start justify-between gap-4 mb-3">
        <div>
          <div class="text-white font-medium">{formatDate(signal.date)}</div>
          <div class="text-sm text-gray-400">{signal.time_slot} UTC</div>
        </div>
        <div class="flex items-center gap-3">
          {signal.macro_overall && (
            <span class="text-sm text-gray-400">{signal.macro_overall}</span>
          )}
          <BiasIndicator bias={signal.bias} size="md" />
        </div>
      </div>
      {extractSummary(signal.output_json) && (
        <p class="text-sm text-gray-300 line-clamp-2">
          {extractSummary(signal.output_json)}
        </p>
      )}
    </div>
  ))}

  {signals.length === 0 && (
    <div class="card text-center py-12">
      <p class="text-gray-400">No historical signals available yet.</p>
    </div>
  )}
</div>
