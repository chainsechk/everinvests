---
// src/components/VIPCTA.astro
interface Props {
  category?: string;
  mode?: 'waitlist' | 'live';
  utmSource?: string;
}

const { category = 'crypto', mode = 'waitlist', utmSource = 'website' } = Astro.props;

const config = {
  waitlist: {
    title: "Don't just get signals. Get the reasoning.",
    subtitle: "You've had the right call beforeâ€”but did you understand why? VIP gives you the full context behind every trade, so you can make informed decisions:",
    cta: 'Join VIP Waitlist',
    url: `https://t.me/everinvests`,
    subtext: null,
  },
  live: {
    title: "Don't just get signals. Get the reasoning.",
    subtitle: "You've had the right call beforeâ€”but did you understand why? VIP gives you the full context behind every trade, so you can make informed decisions:",
    cta: 'Join EverInvests VIP',
    url: `https://t.me/EverInvestsVIPBot?start=${utmSource}_${category}`,
    subtext: null,
  },
};

const c = config[mode];

const features = [
  { name: 'Whale Alerts', desc: 'See when big money loads upâ€”options flow & on-chain data in plain English' },
  { name: 'AI Debate Room', desc: "Bull vs Bear AI agents argue every trade. If they can't agree, we don't trade." },
  { name: 'Full Reasoning', desc: "Every signal explains WHYâ€”so you understand it, not just follow it" },
  { name: 'Private Telegram', desc: 'Real-time chat with serious traders. Ask questions, share setups, get gut checks.' },
  { name: 'Mobile Alerts', desc: 'Telegram pings the moment consensus hitsâ€”no app to check' },
  { name: 'Team Access', desc: "Market freaking out? We're in the chat with you." },
];
---

<div class="relative overflow-hidden rounded-2xl my-8" data-animate>
  <!-- Background gradient -->
  <div class="absolute inset-0 bg-gradient-to-br from-vip/20 via-cyber/10 to-vip/20"></div>
  <div class="absolute inset-0 backdrop-blur-sm" style="background: var(--bg-overlay-medium);"></div>

  <!-- Content -->
  <div class="relative p-6 sm:p-8">
    <!-- Header -->
    <div class="mb-6">
      <h3 class="font-display font-bold text-xl text-txt-primary mb-2 flex items-center gap-2">
        <span class="text-2xl">ðŸš€</span>
        {c.title}
      </h3>
      <p class="text-sm text-txt-secondary">
        {c.subtitle}
      </p>
    </div>

    <!-- Features grid -->
    <ul class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
      {features.map(f => (
        <li class="flex items-start gap-2 text-sm">
          <span class="text-vip mt-0.5 flex-shrink-0">âœ“</span>
          <span>
            <strong class="text-txt-primary">{f.name}</strong>
            <span class="text-txt-muted"> â€” {f.desc}</span>
          </span>
        </li>
      ))}
    </ul>

    <!-- CTA -->
    <div class="flex flex-col sm:flex-row items-center gap-4">
      <a
        href={c.url}
        target="_blank"
        rel="noopener"
        class="btn-vip inline-flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all"
        data-analytics="vip_cta_click"
        data-category={category}
      >
        {c.cta}
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
      {c.subtext && (
        <span class="text-sm text-txt-tertiary">{c.subtext}</span>
      )}
    </div>
  </div>
</div>

<style>
  .btn-vip {
    background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
    color: white;
    box-shadow: 0 4px 14px rgba(233, 69, 96, 0.4);
  }

  .btn-vip:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(233, 69, 96, 0.5);
  }
</style>

<script>
  // Track VIP CTA clicks - both client-side (Zaraz) and server-side
  document.addEventListener('DOMContentLoaded', () => {
    const ctaButtons = document.querySelectorAll('[data-analytics="vip_cta_click"]');
    ctaButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const category = btn.getAttribute('data-category') || 'unknown';

        // Use Cloudflare Zaraz if available
        if (typeof window !== 'undefined' && (window as any).zaraz) {
          (window as any).zaraz.track('vip_cta_click', { category, source: 'website' });
        }

        // Server-side tracking (fire and forget)
        fetch('/api/track', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            event: 'vip_cta_click',
            category,
            source: 'vipcta_component',
            meta: { path: window.location.pathname },
          }),
        }).catch(() => {}); // Ignore errors

        console.log('[Analytics] VIP CTA click:', { category });
      });
    });
  });
</script>
