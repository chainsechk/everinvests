---
// src/components/SignalCard.astro
interface Props {
  category: "crypto" | "forex" | "stocks";
  bias: string | null;
  summary: string | null;
  assetCount: number;
  updatedAt: string | null;
}

const { category, bias, summary, assetCount, updatedAt } = Astro.props;

const categoryLabels: Record<string, string> = {
  crypto: "CRYPTO",
  forex: "FOREX",
  stocks: "STOCKS",
};

const categoryDescriptions: Record<string, string> = {
  crypto: "BTC, ETH",
  forex: "4 major pairs",
  stocks: "25 tickers",
};

function getBiasColor(bias: string | null): string {
  if (!bias) return "text-gray-400";
  const lower = bias.toLowerCase();
  if (lower.includes("bullish")) return "text-bullish";
  if (lower.includes("bearish")) return "text-bearish";
  return "text-neutral";
}

function getBiasArrow(bias: string | null): string {
  if (!bias) return "";
  const lower = bias.toLowerCase();
  if (lower.includes("bullish")) return " ^";
  if (lower.includes("bearish")) return " v";
  return " -";
}

function formatTime(isoString: string | null): string {
  if (!isoString) return "--:--";
  try {
    const date = new Date(isoString);
    return date.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit", timeZone: "UTC" }) + " UTC";
  } catch {
    return "--:--";
  }
}
---

<a href={`/${category}`} class="card hover:border-gray-500 transition-colors group block">
  <div class="flex flex-col h-full">
    <div class="text-xs text-gray-400 font-medium mb-2">{categoryLabels[category]}</div>

    <div class:list={["text-2xl font-bold mb-3", getBiasColor(bias)]}>
      {bias || "No signal"}{getBiasArrow(bias)}
    </div>

    <p class="text-sm text-gray-300 mb-4 flex-grow line-clamp-3">
      {summary || `${categoryDescriptions[category]} - awaiting signal`}
    </p>

    <div class="flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-gray-700">
      <span>{categoryDescriptions[category]}</span>
      <span>{formatTime(updatedAt)}</span>
    </div>

    <div class="mt-3 text-sm text-blue-400 group-hover:text-blue-300 transition-colors">
      View details &rarr;
    </div>
  </div>
</a>
