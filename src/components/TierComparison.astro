---
// src/components/TierComparison.astro
// Side-by-side comparison of Free vs VIP features
import { getLocaleFromUrl, useTranslations } from "../lib/i18n";

interface Props {
  category?: string;
  utmSource?: string;
}

const { category = "crypto", utmSource = "comparison" } = Astro.props;

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

const features = [
  {
    nameKey: "comparison.dailySignals",
    free: { valueKey: "comparison.dailySignalsValue", included: true },
    vip: { valueKey: "comparison.dailySignalsValue", included: true },
  },
  {
    nameKey: "comparison.assetCoverage",
    free: { valueKey: "comparison.assetCoverageFree", included: true },
    vip: { valueKey: "comparison.assetCoverageVip", included: true },
  },
  {
    nameKey: "comparison.macroContext",
    free: { valueKey: "comparison.macroContextValue", included: true },
    vip: { valueKey: "comparison.macroContextValue", included: true },
  },
  {
    nameKey: "comparison.regimeDetection",
    free: { valueKey: "comparison.regimeDetectionFree", included: true },
    vip: { valueKey: "comparison.regimeDetectionVip", included: true },
  },
  {
    nameKey: "comparison.signalReasoning",
    free: { valueKey: "comparison.signalReasoningFree", included: true },
    vip: { valueKey: "comparison.signalReasoningVip", included: true },
  },
  {
    nameKey: "comparison.whaleAlerts",
    free: { valueKey: "comparison.notIncluded", included: false },
    vip: { valueKey: "comparison.whaleAlertsVip", included: true },
  },
  {
    nameKey: "comparison.aiDebateRoom",
    free: { valueKey: "comparison.notIncluded", included: false },
    vip: { valueKey: "comparison.aiDebateRoomVip", included: true },
  },
  {
    nameKey: "comparison.actionDirectives",
    free: { valueKey: "comparison.notIncluded", included: false },
    vip: { valueKey: "comparison.actionDirectivesVip", included: true },
  },
  {
    nameKey: "comparison.privateTelegram",
    free: { valueKey: "comparison.privateTelegramFree", included: true },
    vip: { valueKey: "comparison.privateTelegramVip", included: true },
  },
  {
    nameKey: "comparison.mobileAlerts",
    free: { valueKey: "comparison.mobileAlertsFree", included: true },
    vip: { valueKey: "comparison.mobileAlertsVip", included: true },
  },
];
---

<div class="card" data-animate>
  <div class="text-center mb-6">
    <h3 class="font-display font-bold text-xl text-txt-primary mb-2">{t("comparison.title")}</h3>
    <p class="text-sm text-txt-muted">{t("comparison.subtitle")}</p>
  </div>

  <!-- Desktop Table -->
  <div class="hidden md:block overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b border-border">
          <th class="text-left py-3 px-4 text-txt-muted font-medium">{t("comparison.feature")}</th>
          <th class="text-center py-3 px-4 w-1/3">
            <div class="inline-flex flex-col items-center">
              <span class="text-txt-primary font-semibold">{t("comparison.free")}</span>
              <span class="text-xs text-txt-muted mt-1">{t("comparison.perMonth")}</span>
            </div>
          </th>
          <th class="text-center py-3 px-4 w-1/3 bg-vip/5 rounded-t-lg">
            <div class="inline-flex flex-col items-center">
              <span class="text-vip font-bold">{t("comparison.vip")}</span>
              <span class="text-xs text-txt-muted mt-1">{t("comparison.comingSoon")}</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        {features.map((feature, i) => (
          <tr class:list={["border-b border-subtle", i % 2 === 0 ? "bg-bg-secondary/30" : ""]}>
            <td class="py-3 px-4 text-txt-secondary">{t(feature.nameKey)}</td>
            <td class="text-center py-3 px-4">
              {feature.free.included ? (
                <span class="inline-flex items-center gap-1">
                  <svg class="w-4 h-4 text-bullish" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  <span class="text-txt-muted">{t(feature.free.valueKey)}</span>
                </span>
              ) : (
                <span class="text-txt-muted/50">—</span>
              )}
            </td>
            <td class="text-center py-3 px-4 bg-vip/5">
              {feature.vip.included ? (
                <span class="inline-flex items-center gap-1">
                  <svg class="w-4 h-4 text-vip" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  <span class="text-txt-primary">{t(feature.vip.valueKey)}</span>
                </span>
              ) : (
                <span class="text-txt-muted/50">—</span>
              )}
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <!-- Mobile Cards -->
  <div class="md:hidden space-y-4">
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div class="text-center p-3 rounded-lg bg-surface">
        <div class="font-semibold text-txt-primary">{t("comparison.free")}</div>
        <div class="text-xs text-txt-muted">{t("comparison.perMonth")}</div>
      </div>
      <div class="text-center p-3 rounded-lg bg-vip/10 border border-vip/30">
        <div class="font-bold text-vip">{t("comparison.vip")}</div>
        <div class="text-xs text-txt-muted">{t("comparison.comingSoon")}</div>
      </div>
    </div>

    {features.map((feature) => (
      <div class="border-b border-subtle pb-3">
        <div class="font-medium text-txt-secondary text-sm mb-2">{t(feature.nameKey)}</div>
        <div class="grid grid-cols-2 gap-4 text-xs">
          <div class={feature.free.included ? "text-txt-muted" : "text-txt-muted/50"}>
            {feature.free.included ? `✓ ${t(feature.free.valueKey)}` : "—"}
          </div>
          <div class={feature.vip.included ? "text-txt-primary" : "text-txt-muted/50"}>
            {feature.vip.included ? `✓ ${t(feature.vip.valueKey)}` : "—"}
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- CTA -->
  <div class="mt-6 pt-4 border-t border-border flex flex-col sm:flex-row items-center justify-center gap-4">
    <a
      href="https://t.me/everinvests"
      target="_blank"
      rel="noopener"
      class="btn-vip inline-flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition-all"
    >
      {t("comparison.joinWaitlist")}
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>
    </a>
  </div>
</div>

<style>
  .btn-vip {
    background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
    color: white;
    box-shadow: 0 4px 14px rgba(233, 69, 96, 0.3);
  }

  .btn-vip:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(233, 69, 96, 0.4);
  }

  table {
    border-collapse: separate;
    border-spacing: 0;
  }
</style>
