---
// src/pages/crypto/history.astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import HistoryList from "../../components/HistoryList.astro";
import { getSignalHistory } from "../../lib/db";
import { getLocaleFromUrl } from "../../lib/i18n";

const locale = getLocaleFromUrl(Astro.url);
const category = "crypto" as const;
const categoryTitle = "Crypto";

const db = Astro.locals.runtime?.env?.DB;
let signals: any[] = [];

if (db) {
  signals = await getSignalHistory(db, category, 30);
}
---

<BaseLayout title={`${categoryTitle} History`} description={`Historical ${categoryTitle.toLowerCase()} signals archive.`}>
  <Header slot="header" />

  <div class="space-y-8">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-2 text-sm" data-animate>
      <a href="/" class="text-txt-muted hover:text-txt-primary transition-colors">Home</a>
      <svg class="w-4 h-4 text-txt-muted/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <a href={`/${category}`} class="text-txt-muted hover:text-txt-primary transition-colors">{categoryTitle}</a>
      <svg class="w-4 h-4 text-txt-muted/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <span class="text-txt-primary font-medium">History</span>
    </nav>

    <!-- Page Header -->
    <div data-animate>
      <div class="flex items-center gap-3 mb-2">
        <span class="text-3xl">â‚¿</span>
        <h1 class="font-display font-bold text-3xl sm:text-4xl text-txt-primary">{categoryTitle} History</h1>
      </div>
      <p class="text-txt-secondary font-mono">{signals.length} signals in archive</p>
    </div>

    <!-- Signal List -->
    <HistoryList signals={signals} category={category} locale={locale} />
  </div>

  <Footer slot="footer" />
</BaseLayout>
